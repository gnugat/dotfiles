" File: /23-vim/config/vimrc
" ──────────────────────────────────────────────────────────────────────────────
" vim - Vi IMproved, this programmer's text editor.
" ──────────────────────────────────────────────────────────────────────────────

"" ─────────────────────────────────────────────────────────────────────────────
"" 🔍 Enable filetype detection and associated features.
""
"" - filetype on: Detect file types automatically (e.g., .php, .py, .js)
"" - filetype pugin on: Load filetype-specific plugins from ~/.vim/ftplugin/
"" - filetype indent on: Enable filetype-specific indentation rules
"" ─────────────────────────────────────────────────────────────────────────────
:filetype plugin indent on

"" ─────────────────────────────────────────────────────────────────────────────
"" 📑 Tab and indentation settings.
""
"" - set expandtab: Convert tab characters to spaces
"" - set shiftwidth=4: Number of spaces for each indentation level (e.g., when using >> or <<)
"" - set softtabstop=4: Number of spaces that a <Tab> key press inserts
"" - set tabstop=4:  Number of spaces that a tab character displays as
"" - set smartindent: Automatically indent new lines based on previous line
"" ─────────────────────────────────────────────────────────────────────────────
:set expandtab shiftwidth=4 softtabstop=4 tabstop=4 smartindent

"" ─────────────────────────────────────────────────────────────────────────────
"" Keybindings
"" ─────────────────────────────────────────────────────────────────────────────
let mapleader = " "

"" ─────────────────────────────────────────────────────────────────────────────
"" 🎨 Syntax highlighting in Markdown "fenced" code blocks.
"" ─────────────────────────────────────────────────────────────────────────────
let g:markdown_fenced_languages = ['bash', 'php', 'sql', 'json', 'yaml']

"" ─────────────────────────────────────────────────────────────────────────────
"" Display relative line numbers.
"" ─────────────────────────────────────────────────────────────────────────────
:set relativenumber
:highlight LineNr ctermfg=grey

"" ─────────────────────────────────────────────────────────────────────────────
"" Display vertical ruler to show column width limits.
"" ─────────────────────────────────────────────────────────────────────────────
:set colorcolumn=81,121
:hi ColorColumn ctermbg=grey

"" ─────────────────────────────────────────────────────────────────────────────
"" 🔌 Plugins managed by vim-plug.
"" ─────────────────────────────────────────────────────────────────────────────
call plug#begin('~/.vim/plugged')

Plug 'preservim/nerdtree'          " Tree navigation
Plug 'ctrlpvim/ctrlp.vim'          " Fuzzy finder
Plug 'shawncplus/phpcomplete.vim'  " PHP autocomplete
Plug 'ervandew/supertab'           " Autocomplete
Plug 'vim-vdebug/vdebug'           " Integration with XDebug
Plug 'catppuccin/vim', { 'as': 'catppuccin' } " Theme
Plug 'junegunn/fzf', { 'do': { -> fzf#install() } } " Fuzzy Finder++
Plug 'junegunn/fzf.vim'
Plug 'itchyny/lightline.vim'      " status bar
Plug 'yegappan/lsp'               " LSP client for Vim 9

call plug#end()

"" ─────────────────────────────────────────────────────────────────────────────
"" NERDTree
""
"" Key mappings:
"" - <leader>nf: Find current file in NERDTree
"" ─────────────────────────────────────────────────────────────────────────────
nnoremap <leader>nf :NERDTreeFind<CR>

"" ─────────────────────────────────────────────────────────────────────────────
"" Vdebug
"" ─────────────────────────────────────────────────────────────────────────────
let g:vdebug_options = {
\  'port': 9003,
\  'break_on_open': 0,
\  'path_maps': {
\    '/code': '/Users/loic.faugeron/Projects/primait/prima',
\  },
\  'ide_key': 'VIM',
\}

"" ─────────────────────────────────────────────────────────────────────────────
"" catppuccin machiatto
"" ─────────────────────────────────────────────────────────────────────────────
set termguicolors
colorscheme catppuccin_macchiato

"" ─────────────────────────────────────────────────────────────────────────────
"" fzf
"" ─────────────────────────────────────────────────────────────────────────────
nnoremap <leader>ff :Files<CR>
nnoremap <leader>fo :History<CR>
nnoremap <leader>fb :Buffers<CR>
nnoremap <leader>fg :Rg<Space>

"" ─────────────────────────────────────────────────────────────────────────────
"" lightline
""
"" - set laststatus=2: always display status line (0: never, 1: when 2+ windows)
"" - set noshowmode: removes --INSERT-- mode indicator (lightline shows it)
"" - active.left: components shown on left side of active window's statusline
""   - [ 'mode', 'paste' ]: current mode (INSERT/NORMAL) and paste status
""   - [ 'readonly', 'relativepath', 'modified' ]:
""     readonly: shows [RO] if file is read-only
""     relativepath: file path relative to where vim was opened
""     modified: shows [+] if file has unsaved changes
"" - active.right: components shown on right side of active window's statusline
""   - [ 'lineinfo' ]: cursor position (line:column)
""   - [ 'percent' ]: percentage through file
""   - [ 'filetype' ]: file type (php, python, etc.)
"" ─────────────────────────────────────────────────────────────────────────────
set laststatus=2
set noshowmode
let g:lightline = {
\  'colorscheme': 'catppuccin_macchiato',
\  'active': {
\    'left': [ [ 'mode', 'paste' ],
\              [ 'readonly', 'relativepath', 'modified' ] ],
\    'right': [ [ 'lineinfo' ],
\               [ 'percent' ],
\               [ 'filetype' ] ]
\  }
\ }

"" ─────────────────────────────────────────────────────────────────────────────
"" LSP Configuration
""
"" PHP Language Server: phpactor
"" - See: https://phpactor.readthedocs.io/en/master/
""
"" Key mappings:
"" - gd: Go to definition
"" - gr: Show references
"" - K: Show hover documentation
"" - <leader>rn: Rename symbol
"" - <leader>ca: Code action
"" - [d / ]d: Navigate diagnostics
"" ─────────────────────────────────────────────────────────────────────────────
let lspServers = [#{
\   name: 'phpactor',
\   filetype: ['php'],
\   path: exepath('phpactor'),
\   args: ['language-server'],
\ }]

autocmd VimEnter * call LspAddServer(lspServers)

" LSP key mappings
nnoremap <silent> gd :LspGotoDefinition<CR>
nnoremap <silent> gr :LspShowReferences<CR>
nnoremap <silent> K :LspHover<CR>
nnoremap <silent> <leader>rn :LspRename<CR>
nnoremap <silent> <leader>ca :LspCodeAction<CR>
nnoremap <silent> [d :LspDiag prev<CR>
nnoremap <silent> ]d :LspDiag next<CR>

" LSP options
let lspOpts = #{
\   autoHighlightDiags: v:true,
\   showDiagWithSign: v:true,
\ }
autocmd VimEnter * call LspOptionsSet(lspOpts)
